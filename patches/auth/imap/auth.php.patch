diff --git a/auth/imap/auth.php b/auth/imap/auth.php
index d5dda63..17df433 100644
--- a/auth/imap/auth.php
+++ b/auth/imap/auth.php
@@ -46,7 +46,7 @@ class auth_plugin_imap extends auth_plugin_base {
         }
 
         global $CFG;
-        $hosts = split(';', $this->config->host);   // Could be multiple hosts
+        $hosts = explode(';', $this->config->host);   // Could be multiple hosts
 
         foreach ($hosts as $host) {                 // Try each host in turn
             $host = trim($host);
@@ -69,7 +69,7 @@ class auth_plugin_imap extends auth_plugin_base {
             }
 
             error_reporting(0);
-            $connection = imap_open($host, stripslashes($username), stripslashes($password), OP_HALFOPEN);
+            $connection = imap_open($host, $username, $password, OP_HALFOPEN);
             error_reporting($CFG->debug);
 
             if ($connection) {
@@ -108,10 +108,10 @@ class auth_plugin_imap extends auth_plugin_base {
      * Returns the URL for changing the user's pw, or empty if the default can
      * be used.
      *
-     * @return string
+     * @return moodle_url
      */
     function change_password_url() {
-        return $this->config->changepasswordurl;
+        return new moodle_url($this->config->changepasswordurl);
     }
 
     /**
@@ -123,6 +123,8 @@ class auth_plugin_imap extends auth_plugin_base {
      * @param array $page An object containing all the data for this page.
      */
     function config_form($config, $err, $user_fields) {
+        global $OUTPUT;
+
         include "config.html";
     }
 
@@ -155,4 +157,4 @@ class auth_plugin_imap extends auth_plugin_base {
 
 }
 
-?>
+
