diff --git a/login/change_password_form.php b/login/change_password_form.php
index aacbeaa..6b8fffe 100644
--- a/login/change_password_form.php
+++ b/login/change_password_form.php
@@ -1,8 +1,30 @@
-<?php //$Id$
-
-if (!defined('MOODLE_INTERNAL')) {
-    die('Direct access to this script is forbidden.');    ///  It must be included from a Moodle page
-}
+<?php
+
+// This file is part of Moodle - http://moodle.org/
+//
+// Moodle is free software: you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation, either version 3 of the License, or
+// (at your option) any later version.
+//
+// Moodle is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
+
+/**
+ * Change password form definition.
+ *
+ * @package    core
+ * @subpackage auth
+ * @copyright  2006 Petr Skoda {@link http://skodak.org}
+ * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ */
+
+defined('MOODLE_INTERNAL') || die();
 
 require_once $CFG->libdir.'/formslib.php';
 
@@ -11,7 +33,7 @@ class login_change_password_form extends moodleform {
     function definition() {
         global $USER, $CFG;
 
-        $mform =& $this->_form;
+        $mform = $this->_form;
 
         $mform->addElement('header', '', get_string('changepassword'), '');
 
@@ -54,7 +76,7 @@ class login_change_password_form extends moodleform {
         update_login_count();
 
         // ignore submitted username
-        if (!$user = authenticate_user_login(addslashes($USER->username), $data['password'])) {
+        if (!$user = authenticate_user_login($USER->username, $data['password'])) {
             $errors['password'] = get_string('invalidlogin');
             return $errors;
         }
@@ -83,4 +105,3 @@ class login_change_password_form extends moodleform {
         return $errors;
     }
 }
-?>
