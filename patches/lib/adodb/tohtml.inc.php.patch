diff --git a/lib/adodb/tohtml.inc.php b/lib/adodb/tohtml.inc.php
index 44267d2..7624566 100644
--- a/lib/adodb/tohtml.inc.php
+++ b/lib/adodb/tohtml.inc.php
@@ -1,6 +1,6 @@
 <?php 
 /*
-  V4.93 10 Oct 2006  (c) 2000-2008 John Lim (jlim#natsoft.com.my). All rights reserved.
+  V4.93 10 Oct 2006  (c) 2000-2010 John Lim (jlim#natsoft.com). All rights reserved.
   Released under both BSD license and Lesser GPL library license. 
   Whenever there is any discrepancy between the two licenses, 
   the BSD license will take precedence.
@@ -84,14 +84,18 @@ GLOBAL $gSQLMaxRows,$gSQLBlockRows,$ADODB_ROUND;
 			$type = $typearr[$i];
 			switch($type) {
 			case 'D':
-				if (empty($v)) $s .= "<TD> &nbsp; </TD>\n";
-				else if (!strpos($v,':')) {
-					$s .= "	<TD>".$rs->UserDate($v,"D d, M Y") ."&nbsp;</TD>\n";
+				if (strpos($v,':') !== false);
+				else {
+					if (empty($v)) {
+					$s .= "<TD> &nbsp; </TD>\n";
+					} else {
+						$s .= "	<TD>".$rs->UserDate($v,"D d, M Y") ."</TD>\n";				
 				}
 				break;
+				}
 			case 'T':
 				if (empty($v)) $s .= "<TD> &nbsp; </TD>\n";
-				else $s .= "	<TD>".$rs->UserTimeStamp($v,"D d, M Y, h:i:s") ."&nbsp;</TD>\n";
+				else $s .= "	<TD>".$rs->UserTimeStamp($v,"D d, M Y, H:i:s") ."</TD>\n";
 			break;
 			
 			case 'N':
@@ -100,7 +104,9 @@ GLOBAL $gSQLMaxRows,$gSQLBlockRows,$ADODB_ROUND;
 				else
 					$v = round($v,$ADODB_ROUND);
 			case 'I':
-				$s .= "	<TD align=right>".stripslashes((trim($v))) ."&nbsp;</TD>\n";
+				$vv = stripslashes((trim($v)));
+				if (strlen($vv) == 0) $vv .= '&nbsp;';
+				$s .= "	<TD align=right>".$vv ."</TD>\n";
 			   	
 			break;
 			/*
@@ -176,7 +182,7 @@ function arr2html(&$arr,$ztabhtml='',$zheaderarray='')
 	
 	for ($i=0; $i<sizeof($arr); $i++) {
 		$s .= '<TR>';
-		$a = &$arr[$i];
+		$a = $arr[$i];
 		if (is_array($a)) 
 			for ($j=0; $j<sizeof($a); $j++) {
 				$val = $a[$j];
