diff --git a/notes/delete.php b/notes/delete.php
index 285eab0..f69f103 100644
--- a/notes/delete.php
+++ b/notes/delete.php
@@ -1,4 +1,4 @@
-<?php // $Id$
+<?php
 
 require_once('../config.php');
 require_once('lib.php');
@@ -6,19 +6,21 @@ require_once('lib.php');
 // retrieve parameters
 $noteid = required_param('id', PARAM_INT);
 
+$PAGE->set_url('/notes/delete.php', array('id'=>$noteid));
+
 // locate note information
 if (!$note = note_load($noteid)) {
-    error('Incorrect note id specified');
+    print_error('invalidid');
 }
 
 // locate course information
-if (!$course = get_record('course', 'id', $note->courseid)) {
-    error('Incorrect course id found');
+if (!$course = $DB->get_record('course', array('id'=>$note->courseid))) {
+    print_error('invalidcourseid');
 }
 
 // locate user information
-    if (!$user = get_record('user', 'id', $note->userid)) {
-        error('Incorrect user id found');
+    if (!$user = $DB->get_record('user', array('id'=>$note->userid))) {
+        print_error('invaliduserid');
     }
 
 // require login to access notes
@@ -53,16 +55,19 @@ if (data_submitted() && confirm_sesskey()) {
     $optionsno  = array('course'=>$course->id, 'user'=>$note->userid);
 
 // output HTML
+    $link = null;
     if (has_capability('moodle/course:viewparticipants', $context) || has_capability('moodle/site:viewparticipants', get_context_instance(CONTEXT_SYSTEM))) {
-        $nav[] = array('name' => get_string('participants'), 'link' => $CFG->wwwroot . '/user/index.php?id=' . $course->id, 'type' => 'misc');
+        $link = new moodle_url('/user/index.php',array('id'=>$course->id));
     }
-    $nav[] = array('name' => fullname($user), 'link' => $CFG->wwwroot . '/user/view.php?id=' . $user->id. '&amp;course=' . $course->id, 'type' => 'misc');
-    $nav[] = array('name' => get_string('notes', 'notes'), 'link' => $CFG->wwwroot . '/notes/index.php?course=' . $course->id . '&amp;user=' . $user->id, 'type' => 'misc');
-    $nav[] = array('name' => get_string('delete'), 'link' => '', 'type' => 'activity');
-    print_header($course->shortname . ': ' . $strnotes, $course->fullname, build_navigation($nav));
-    notice_yesno(get_string('deleteconfirm', 'notes'), 'delete.php', 'index.php', $optionsyes, $optionsno, 'post', 'get');
+    $PAGE->navbar->add(get_string('participants'), $link);
+    $PAGE->navbar->add(fullname($user), new moodle_url('/user/view.php', array('id'=>$user->id,'course'=>$course->id)));
+    $PAGE->navbar->add(get_string('notes', 'notes'), new moodle_url('/notes/index.php', array('user'=>$user->id,'course'=>$course->id)));
+    $PAGE->navbar->add(get_string('delete'));
+    $PAGE->set_title($course->shortname . ': ' . $strnotes);
+    $PAGE->set_heading($course->fullname);
+    echo $OUTPUT->header();
+    echo $OUTPUT->confirm(get_string('deleteconfirm', 'notes'), new moodle_url('delete.php',$optionsyes),  new moodle_url('index.php',$optionsno));
     echo '<br />';
     note_print($note, NOTES_SHOW_BODY | NOTES_SHOW_HEAD);
-    print_footer();
+    echo $OUTPUT->footer();
 }
-?>
