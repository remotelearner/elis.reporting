diff --git a/question/export_form.php b/question/export_form.php
index 95a7190..7a95abb 100644
--- a/question/export_form.php
+++ b/question/export_form.php
@@ -1,59 +1,83 @@
-<?php  // $Id$
+<?php
+// This file is part of Moodle - http://moodle.org/
+//
+// Moodle is free software: you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation, either version 3 of the License, or
+// (at your option) any later version.
+//
+// Moodle is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
 
-if (!defined('MOODLE_INTERNAL')) {
-    die('Direct access to this script is forbidden.');    ///  It must be included from a Moodle page
-}
+/**
+ * Defines the export questions form.
+ *
+ * @package    moodlecore
+ * @subpackage questionbank
+ * @copyright  2007 Jamie Pratt me@jamiep.org
+ * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ */
+
+
+defined('MOODLE_INTERNAL') || die();
+
+require_once($CFG->libdir . '/formslib.php');
 
-require_once($CFG->libdir.'/formslib.php');
 
+/**
+ * Form to export questions from the question bank.
+ *
+ * @copyright  2007 Jamie Pratt me@jamiep.org
+ * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ */
 class question_export_form extends moodleform {
 
-    function definition() {
-        $mform    =& $this->_form;
+    protected function definition() {
+        $mform = $this->_form;
 
         $defaultcategory   = $this->_customdata['defaultcategory'];
         $contexts   = $this->_customdata['contexts'];
-        $defaultfilename = $this->_customdata['defaultfilename'];
-//--------------------------------------------------------------------------------
-        $mform->addElement('header','fileformat',get_string('fileformat','quiz'));
+
+        // Choice of format, with help.
+        $mform->addElement('header', 'fileformat', get_string('fileformat', 'question'));
         $fileformatnames = get_import_export_formats('export');
         $radioarray = array();
-        foreach ($fileformatnames as $id => $fileformatname) {
-            $radioarray[] = &MoodleQuickForm::createElement('radio','format','',$fileformatname,$id);
+        $i = 0 ;
+        foreach ($fileformatnames as $shortname => $fileformatname) {
+            $currentgrp1 = array();
+            $currentgrp1[] = $mform->createElement('radio', 'format', '', $fileformatname, $shortname);
+            $mform->addGroup($currentgrp1, "formathelp[$i]", '', array('<br />'), false);
+            $mform->addHelpButton("formathelp[$i]", $shortname, 'qformat_' . $shortname);
+            $i++ ;
         }
-        $mform->addGroup($radioarray,'format','',array('<br />'),false);
-        $mform->setHelpButton('format', array('export', get_string('exportquestions', 'quiz'), 'quiz'));
-        $mform->addRule('format',null,'required',null,'client'); 
+        $mform->addRule("formathelp[0]", null, 'required', null, 'client');
 
-//--------------------------------------------------------------------------------
-        $mform->addElement('header','general', get_string('general', 'form'));
+        // Export options.
+        $mform->addElement('header', 'general', get_string('general', 'form'));
 
-        $mform->addElement('questioncategory', 'category', get_string('category','quiz'), compact('contexts'));
+        $mform->addElement('questioncategory', 'category', get_string('exportcategory', 'question'), compact('contexts'));
         $mform->setDefault('category', $defaultcategory);
-        $mform->setHelpButton('category', array('exportcategory', get_string('exportcategory','question'), 'quiz'));
+        $mform->addHelpButton('category', 'exportcategory', 'question');
 
         $categorygroup = array();
-        $categorygroup[] =& $mform->createElement('checkbox', 'cattofile', '', get_string('tofilecategory', 'question'));
-        $categorygroup[] =& $mform->createElement('checkbox', 'contexttofile', '', get_string('tofilecontext', 'question'));
+        $categorygroup[] = $mform->createElement('checkbox', 'cattofile', '', get_string('tofilecategory', 'question'));
+        $categorygroup[] = $mform->createElement('checkbox', 'contexttofile', '', get_string('tofilecontext', 'question'));
         $mform->addGroup($categorygroup, 'categorygroup', '', '', false);
         $mform->disabledIf('categorygroup', 'cattofile', 'notchecked');
         $mform->setDefault('cattofile', 1);
         $mform->setDefault('contexttofile', 1);
         
+        // Set a template for the format select elements
+        $renderer = $mform->defaultRenderer();
+        $template = "{help} {element}\n";
+        $renderer->setGroupElementTemplate($template, 'format');
 
-//        $fileformatnames = get_import_export_formats('export');
-//        $mform->addElement('select', 'format', get_string('fileformat','quiz'), $fileformatnames);
-//        $mform->setDefault('format', 'gift');
-//        $mform->setHelpButton('format', array('export', get_string('exportquestions', 'quiz'), 'quiz'));
-
-        $mform->addElement('text', 'exportfilename', get_string('exportname', 'quiz'), array('size'=>40));
-        $mform->setDefault('exportfilename', $defaultfilename);
-        $mform->setType('exportfilename', PARAM_CLEANFILE);
-
-
-//--------------------------------------------------------------------------------
-        $this->add_action_buttons(false, get_string('exportquestions', 'quiz'));
-//--------------------------------------------------------------------------------
+        // Submit buttons.
+        $this->add_action_buttons(false, get_string('exportquestions', 'question'));
     }
 }
-?>
