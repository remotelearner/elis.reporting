diff --git a/question/edit.php b/question/edit.php
index ab82c42..411cb37 100644
--- a/question/edit.php
+++ b/question/edit.php
@@ -1,62 +1,73 @@
-<?php // $Id$
+<?php
+// This file is part of Moodle - http://moodle.org/
+//
+// Moodle is free software: you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation, either version 3 of the License, or
+// (at your option) any later version.
+//
+// Moodle is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
+
 /**
-* Page to edit the question bank
-*
-* TODO: add logging
-*
-* @author Martin Dougiamas and many others. This has recently been extensively
-*         rewritten by Gustav Delius and other members of the Serving Mathematics project
-*         {@link http://maths.york.ac.uk/serving_maths}
-* @license http://www.gnu.org/copyleft/gpl.html GNU Public License
-* @package questionbank
-*/
-
-    require_once("../config.php");
-    require_once("editlib.php");
-
-    list($thispageurl, $contexts, $cmid, $cm, $module, $pagevars) = question_edit_setup('questions');
-
-    question_showbank_actions($thispageurl, $cm);
-
-    $context = $contexts->lowest();
-    $streditingquestions = get_string('editquestions', "quiz");
-    if ($cm!==null) {
-        $strupdatemodule = has_capability('moodle/course:manageactivities', $contexts->lowest())
-            ? update_module_button($cm->id, $COURSE->id, get_string('modulename', $cm->modname))
-            : "";
-        $navlinks = array();
-        $navlinks[] = array('name' => get_string('modulenameplural', $cm->modname), 'link' => "$CFG->wwwroot/mod/{$cm->modname}/index.php?id=$COURSE->id", 'type' => 'activity');
-        $navlinks[] = array('name' => format_string($module->name), 'link' => "$CFG->wwwroot/mod/{$cm->modname}/view.php?id={$cm->id}", 'type' => 'title');
-        $navlinks[] = array('name' => $streditingquestions, 'link' => '', 'type' => 'title');
-        $navigation = build_navigation($navlinks);
-        print_header_simple($streditingquestions, '', $navigation, "", "", true, $strupdatemodule);
-
-        $currenttab = 'edit';
-        $mode = 'questions';
-        ${$cm->modname} = $module;
-        include($CFG->dirroot."/mod/$cm->modname/tabs.php");
-    } else {
-        // Print basic page layout.
-        $navlinks = array();
-        $navlinks[] = array('name' => $streditingquestions, 'link' => '', 'type' => 'title');
-        $navigation = build_navigation($navlinks);
-
-        print_header_simple($streditingquestions, '', $navigation);
-
-        // print tabs
-        $currenttab = 'questions';
-        include('tabs.php');
-    }
-
-
-    echo '<table class="boxaligncenter" border="0" cellpadding="2" cellspacing="0">';
-    echo '<tr><td valign="top">';
-
-    question_showbank('questions', $contexts, $thispageurl, $cm, $pagevars['qpage'], $pagevars['qperpage'], $pagevars['qsortorder'], $pagevars['qsortorderdecoded'],
-                    $pagevars['cat'], $pagevars['recurse'], $pagevars['showhidden'], $pagevars['showquestiontext']);
-
-    echo '</td></tr>';
-    echo '</table>';
-
-    print_footer($COURSE);
-?>
+ * Page to edit the question bank
+ *
+ * @package    moodlecore
+ * @subpackage questionbank
+ * @copyright  1999 onwards Martin Dougiamas {@link http://moodle.com}
+ * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ */
+
+
+require_once(dirname(__FILE__) . '/../config.php');
+require_once($CFG->dirroot . '/question/editlib.php');
+
+$url = new moodle_url('/question/edit.php');
+if (($lastchanged = optional_param('lastchanged', 0, PARAM_INT)) !== 0) {
+    $url->param('lastchanged', $lastchanged);
+}
+if (($category = optional_param('category', 0, PARAM_TEXT)) !== 0) {
+    $url->param('category', $category);
+}
+if (($qpage = optional_param('qpage', 0, PARAM_INT)) !== 0) {
+    $url->param('qpage', $qpage);
+}
+if (($cat = optional_param('cat', 0, PARAM_TEXT)) !== 0) {
+    $url->param('cat', $cat);
+}
+if (($courseid = optional_param('courseid', 0, PARAM_INT)) !== 0) {
+    $url->param('courseid', $courseid);
+}
+if (($returnurl = optional_param('returnurl', 0, PARAM_INT)) !== 0) {
+    $url->param('returnurl', $returnurl);
+}
+if (($cmid = optional_param('cmid', 0, PARAM_INT)) !== 0) {
+    $url->param('cmid', $cmid);
+}
+$PAGE->set_url($url);
+
+list($thispageurl, $contexts, $cmid, $cm, $module, $pagevars) =
+        question_edit_setup('questions', '/question/edit.php');
+$questionbank = new question_bank_view($contexts, $thispageurl, $COURSE, $cm);
+$questionbank->process_actions();
+
+// TODO log this page view.
+
+$context = $contexts->lowest();
+$streditingquestions = get_string('editquestions', 'question');
+$PAGE->set_title($streditingquestions);
+$PAGE->set_heading($COURSE->fullname);
+echo $OUTPUT->header();
+
+echo '<div class="questionbankwindow boxwidthwide boxaligncenter">';
+$questionbank->display('questions', $pagevars['qpage'], $pagevars['qperpage'],
+        $pagevars['cat'], $pagevars['recurse'], $pagevars['showhidden'],
+        $pagevars['qbshowtext']);
+echo "</div>\n";
+
+echo $OUTPUT->footer();
