diff --git a/admin/user/user_bulk_display.php b/admin/user/user_bulk_display.php
old mode 100755
new mode 100644
index 97d36f3..1e8514a
--- a/admin/user/user_bulk_display.php
+++ b/admin/user/user_bulk_display.php
@@ -1,4 +1,4 @@
-<?php // $Id$
+<?php
 
 require_once('../../config.php');
 require_once($CFG->libdir.'/adminlib.php');
@@ -20,12 +20,12 @@ $usercount = count($users);
 
 $strnever = get_string('never');
 
-admin_externalpage_print_header();
+echo $OUTPUT->header();
 
-$countries = get_list_of_countries();
+$countries = get_string_manager()->get_list_of_countries(true);
 
 foreach ($users as $key => $id) {
-    $user = get_record('user', 'id', $id, null, null, null, null, 'id, firstname, lastname, username, email, country, lastaccess, city');
+    $user = $DB->get_record('user', array('id'=>$id), 'id, firstname, lastname, username, email, country, lastaccess, city');
     $user->fullname = fullname($user, true);
     $user->country = @$countries[$user->country];
     unset($user->firstname);
@@ -46,6 +46,7 @@ function sort_compare($a, $b) {
 }
 usort($users, 'sort_compare');
 
+$table = new html_table();
 $table->width = "95%";
 $columns = array('fullname', /*'username', */'email', 'city', 'country', 'lastaccess');
 foreach ($columns as $column) {
@@ -55,7 +56,7 @@ foreach ($columns as $column) {
         $columndir = 'asc';
     } else {
         $columndir = $dir == 'asc' ? 'desc' : 'asc';
-        $columnicon = ' <img src="'.$CFG->pixpath.'/t/'.($dir == 'asc' ? 'down' : 'up' ).'.gif" alt="" />';
+        $columnicon = ' <img src="'.$OUTPUT->pix_url('t/'.($dir == 'asc' ? 'down' : 'up' )).'f" alt="" />';
     }
     $table->head[] = '<a href="user_bulk_display.php?sort='.$column.'&amp;dir='.$columndir.'">'.$strtitle.'</a>'.$columnicon;
     $table->align[] = 'left';
@@ -72,10 +73,9 @@ foreach($users as $user) {
     );
 }
 
-print_heading("$usercount / $usertotal ".get_string('users'));
-print_table($table);
+echo $OUTPUT->heading("$usercount / $usertotal ".get_string('users'));
+echo html_writer::table($table);
 
-print_continue($return);
+echo $OUTPUT->continue_button($return);
 
-admin_externalpage_print_footer();
-?>
\ No newline at end of file
+echo $OUTPUT->footer();
