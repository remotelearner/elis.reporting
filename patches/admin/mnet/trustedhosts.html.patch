diff --git a/admin/mnet/trustedhosts.html b/admin/mnet/trustedhosts.html
index 26da169..e48a3d3 100644
--- a/admin/mnet/trustedhosts.html
+++ b/admin/mnet/trustedhosts.html
@@ -1,5 +1,5 @@
 <?php
-admin_externalpage_print_header();
+echo $OUTPUT->header();
 ?>
 <div id="trustedhosts"><!-- See theme/standard/styles_layout.css #trustedhosts .generaltable for rules -->
 <table cellspacing="0" cellpadding="5"  class="generaltable generalbox" >
@@ -13,7 +13,7 @@ admin_externalpage_print_header();
         <td class="cell c1" colspan="2">
             <form  method="post" action="trustedhosts.php">
             <div>
-                <input type="hidden" name="sesskey" value="<?php echo $USER->sesskey ?>" />
+                <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />
                 <textarea name="hostlist" cols="40" rows="20"><?php echo $trusted_hosts; ?></textarea><br />
                 <input type="submit" value="<?php print_string('savechanges'); ?>" />
             </div>
@@ -54,7 +54,7 @@ admin_externalpage_print_header();
         <td class="cell c1" colspan="2">
             <form  method="get" action="trustedhosts.php">
             <div>
-                <input type="hidden" name="sesskey" value="<?php echo $USER->sesskey ?>" />
+                <input type="hidden" name="sesskey" value="<?php echo sesskey() ?>" />
                 <input type="text" name="testipaddress" value="<?php echo $test_ip_address; ?>" />
                 <input type="submit" value="<?php print_string('go'); ?>" />
             </div>
@@ -64,5 +64,5 @@ admin_externalpage_print_header();
 </table>
 </div>
 <?php
-admin_externalpage_print_footer();
+echo $OUTPUT->footer();
 ?>
