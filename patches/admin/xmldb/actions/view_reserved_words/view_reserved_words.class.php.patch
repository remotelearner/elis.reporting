diff --git a/admin/xmldb/actions/view_reserved_words/view_reserved_words.class.php b/admin/xmldb/actions/view_reserved_words/view_reserved_words.class.php
index 2390c66..b5aaee1 100644
--- a/admin/xmldb/actions/view_reserved_words/view_reserved_words.class.php
+++ b/admin/xmldb/actions/view_reserved_words/view_reserved_words.class.php
@@ -1,34 +1,36 @@
-<?php // $Id$
-
-///////////////////////////////////////////////////////////////////////////
-//                                                                       //
-// NOTICE OF COPYRIGHT                                                   //
-//                                                                       //
-// Moodle - Modular Object-Oriented Dynamic Learning Environment         //
-//          http://moodle.com                                            //
-//                                                                       //
-// Copyright (C) 1999 onwards Martin Dougiamas        http://dougiamas.com  //
-//           (C) 2001-3001 Eloy Lafuente (stronk7) http://contiento.com  //
-//                                                                       //
-// This program is free software; you can redistribute it and/or modify  //
-// it under the terms of the GNU General Public License as published by  //
-// the Free Software Foundation; either version 2 of the License, or     //
-// (at your option) any later version.                                   //
-//                                                                       //
-// This program is distributed in the hope that it will be useful,       //
-// but WITHOUT ANY WARRANTY; without even the implied warranty of        //
-// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         //
-// GNU General Public License for more details:                          //
-//                                                                       //
-//          http://www.gnu.org/copyleft/gpl.html                         //
-//                                                                       //
-///////////////////////////////////////////////////////////////////////////
-
-/// This class will show all the reserved words in a format suitable to
-/// be pasted to: http://docs.moodle.org/19/en/XMLDB_reserved_words and
-/// http://docs.moodle.org/19/en/Database_reserved_words
-/// Also, it introspects te DB looking for such words and informing about
+<?php
+
+// This file is part of Moodle - http://moodle.org/
+//
+// Moodle is free software: you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation, either version 3 of the License, or
+// (at your option) any later version.
+//
+// Moodle is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
+
+/**
+ * @package   xmldb-editor
+ * @copyright 2003 onwards Eloy Lafuente (stronk7) {@link http://stronk7.com}
+ * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ */
 
+/**
+ * This class will show all the reserved words in a format suitable to
+ * be pasted to: http://docs.moodle.org/en/XMLDB_reserved_words and
+ * http://docs.moodle.org/en/Database_reserved_words
+ * Also, it introspects te DB looking for such words and informing about
+ *
+ * @package   xmldb-editor
+ * @copyright 2003 onwards Eloy Lafuente (stronk7) {@link http://stronk7.com}
+ * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ */
 class view_reserved_words extends XMLDBAction {
 
     /**
@@ -64,49 +66,27 @@ class view_reserved_words extends XMLDBAction {
         $this->does_generate = ACTION_GENERATE_HTML;
 
     /// These are always here
-        global $CFG, $XMLDB, $db;
+        global $CFG, $XMLDB, $DB;
 
     /// Calculate list of available SQL generators
-        $plugins = get_list_of_plugins('lib/xmldb/classes/generators');
-        $reserved_words = array();
-        $reserved_words_bydb = array();
-        foreach($plugins as $plugin) {
-            $classname = 'XMLDB' . $plugin;
-            $generator = new $classname();
-            $reserved_words = array_merge($reserved_words, $generator->getReservedWords());
-            $reserved_words_bydb[$plugin] = $generator->getReservedWords();
-        }
-        sort($reserved_words);
-        $reserved_words = array_unique($reserved_words);
+        require_once("$CFG->libdir/ddl/sql_generator.php");
+        $reserved_words = sql_generator::getAllReservedWords();
 
     /// Now, calculate, looking into current DB (with AdoDB Metadata), which fields are
     /// in the list of reserved words
         $wronguses = array();
-        $dbtables = $db->MetaTables('TABLES');
+        $dbtables = $DB->get_tables();
         if ($dbtables) {
-            foreach ($dbtables as $dbtable) {
-                $table = str_replace($CFG->prefix, '', $dbtable);
-                if (in_array($table, $reserved_words)) {
-                    $list_of_db = array();
-                    foreach ($reserved_words_bydb as $key=>$words) {
-                        if (in_array($table, $words)) {
-                            $list_of_db[] = $key;
-                        }
-                    }
-                    $wronguses[] = $this->str['table'] . ' - ' . $table . ' (' . implode(', ',$list_of_db) . ')';
+            foreach ($dbtables as $table) {
+                if (array_key_exists($table, $reserved_words)) {
+                    $wronguses[] = $this->str['table'] . ' - ' . $table . ' (' . implode(', ',$reserved_words[$table]) . ')';
 
                 }
-                $dbfields = $db->MetaColumns($dbtable);
+                $dbfields = $DB->get_columns($table);
                 if ($dbfields) {
                     foreach ($dbfields as $dbfield) {
-                        if (in_array($dbfield->name, $reserved_words)) {
-                            $list_of_db = array();
-                            foreach ($reserved_words_bydb as $key=>$words) {
-                                if (in_array($dbfield->name, $words)) {
-                                    $list_of_db[] = $key;
-                                }
-                            }
-                            $wronguses[] = $this->str['field'] . ' - ' . $table . '->' . $dbfield->name . ' (' . implode(', ',$list_of_db) . ')';
+                        if (array_key_exists($dbfield->name, $reserved_words)) {
+                            $wronguses[] = $this->str['field'] . ' - ' . $table . '->' . $dbfield->name . ' (' . implode(', ',$reserved_words[$dbfield->name]) . ')';
                         }
                     }
                 }
@@ -136,7 +116,7 @@ class view_reserved_words extends XMLDBAction {
         $o.= '    <table id="formelements" class="boxaligncenter" cellpadding="5">';
         $o.= '      <tr><td align="center">' . $this->str['listreservedwords'].'</td></tr>';
         $o.= '      <tr><td><textarea cols="80" rows="32">';
-        $o.= s(implode(', ', $reserved_words));
+        $o.= s(implode(', ', array_keys($reserved_words)));
         $o.= '</textarea></td></tr>';
         $o.= '    </table>';
 
@@ -151,4 +131,4 @@ class view_reserved_words extends XMLDBAction {
         return $result;
     }
 }
-?>
+
