diff --git a/mod/data/field/latlong/mod.html b/mod/data/field/latlong/mod.html
old mode 100755
new mode 100644
index ec84b48..fb34fb4
--- a/mod/data/field/latlong/mod.html
+++ b/mod/data/field/latlong/mod.html
@@ -29,14 +29,14 @@
             <option value="-2"<?php if($this->field->param2==-2) echo ' selected="selected"' ?>><?php echo get_string('latitude', 'data').'/'.get_string('longitude', 'data') ?></option>
             <?php
                 // Fetch all "suitable" other fields that exist for this database
-                $textfields = get_records_select('data_fields', 'dataid='.$this->data->id." AND type='text'");
-                echo '<optgroup label="'.get_string('latlongotherfields', 'data').':">';
+                $textfields = $DB->get_records('data_fields', array('dataid'=>$this->data->id, 'type'=>'text'));
                 if(sizeof($textfields)>0) {
+                echo '<optgroup label="'.get_string('latlongotherfields', 'data').':">';
                     foreach($textfields as $textfield) {
                         echo "<option value='$textfield->id'".($this->field->param2==$textfield->id ? ' selected="selected"' : '').">$textfield->name</option>";
                     }
-                }
                 echo '</optgroup>';
+                }
             ?>
           </select>
         </td>
