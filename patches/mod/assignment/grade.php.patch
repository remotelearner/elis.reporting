diff --git a/mod/assignment/grade.php b/mod/assignment/grade.php
index a4bd1b8..a89c33b 100644
--- a/mod/assignment/grade.php
+++ b/mod/assignment/grade.php
@@ -1,27 +1,26 @@
-<?php  // $Id$
+<?php
 
-    require_once("../../config.php");
+require_once("../../config.php");
 
-    $id   = required_param('id', PARAM_INT);          // Course module ID
+$id   = required_param('id', PARAM_INT);          // Course module ID
 
-    if (! $cm = get_coursemodule_from_id('assignment', $id)) {
-        error("Course Module ID was incorrect");
-    }
+$PAGE->set_url('/mod/assignment/grade.php', array('id'=>$id));
+if (! $cm = get_coursemodule_from_id('assignment', $id)) {
+    print_error('invalidcoursemodule');
+}
 
-    if (! $assignment = get_record("assignment", "id", $cm->instance)) {
-        error("assignment ID was incorrect");
-    }
+if (! $assignment = $DB->get_record("assignment", array("id"=>$cm->instance))) {
+    print_error('invalidid', 'assignment');
+}
 
-    if (! $course = get_record("course", "id", $assignment->course)) {
-        error("Course is misconfigured");
-    }
+if (! $course = $DB->get_record("course", array("id"=>$assignment->course))) {
+    print_error('coursemisconf', 'assignment');
+}
 
-    require_login($course->id, false, $cm);
+require_login($course, false, $cm);
 
-    if (has_capability('mod/assignment:grade', get_context_instance(CONTEXT_MODULE, $cm->id))) {
+if (has_capability('mod/assignment:grade', get_context_instance(CONTEXT_MODULE, $cm->id))) {
         redirect('submissions.php?id='.$cm->id);
-    } else {
+} else {
         redirect('view.php?id='.$cm->id);
-    }
-
-?>
+}
\ No newline at end of file
