diff --git a/theme/canvas/layout/frontpage.php b/theme/canvas/layout/frontpage.php
index a8b573d..c2d54c8 100644
--- a/theme/canvas/layout/frontpage.php
+++ b/theme/canvas/layout/frontpage.php
@@ -1,19 +1,24 @@
 <?php
 
-$hasheading = ($PAGE->heading);
-$hasnavbar = (empty($PAGE->layout_options['nonavbar']) && $PAGE->has_navbar());
-$hasfooter = (empty($PAGE->layout_options['nofooter']));
 $hassidepre = $PAGE->blocks->region_has_content('side-pre', $OUTPUT);
 $hassidepost = $PAGE->blocks->region_has_content('side-post', $OUTPUT);
+$showsidepre = $hassidepre && !$PAGE->blocks->region_completely_docked('side-pre', $OUTPUT);
+$showsidepost = $hassidepost && !$PAGE->blocks->region_completely_docked('side-post', $OUTPUT);
+
+$custommenu = $OUTPUT->custom_menu();
+$hascustommenu = (empty($PAGE->layout_options['nocustommenu']) && !empty($custommenu));
 
 $bodyclasses = array();
-if ($hassidepre && !$hassidepost) {
+if ($showsidepre && !$showsidepost) {
     $bodyclasses[] = 'side-pre-only';
-} else if ($hassidepost && !$hassidepre) {
+} else if ($showsidepost && !$showsidepre) {
     $bodyclasses[] = 'side-post-only';
-} else if (!$hassidepost && !$hassidepre) {
+} else if (!$showsidepost && !$showsidepre) {
     $bodyclasses[] = 'content-only';
 }
+if ($hascustommenu) {
+    $bodyclasses[] = 'has_custom_menu';
+}
 
 echo $OUTPUT->doctype() ?>
 <html <?php echo $OUTPUT->htmlattributes() ?>>
@@ -45,6 +50,10 @@ echo $OUTPUT->doctype() ?>
 	    	</div>
 	    </div>
 
+        <?php if ($hascustommenu) { ?>
+            <div id="custommenu"><?php echo $custommenu; ?></div>
+        <?php } ?>
+
         <div class="clearer"></div> <!-- temporarily added on 06/25/10 -->
 
 <!-- END OF HEADER -->
@@ -65,7 +74,7 @@ echo $OUTPUT->doctype() ?>
     		            </div>
 
         		        <?php if ($hassidepre) { ?>
-            		    <div id="region-pre">
+                        <div id="region-pre" class="block-region">
                 		    <div class="region-content">
                     		    <?php echo $OUTPUT->blocks_for_region('side-pre') ?>
 		                    </div>
@@ -73,7 +82,7 @@ echo $OUTPUT->doctype() ?>
         		        <?php } ?>
 
 	        	        <?php if ($hassidepost) { ?>
-    	        	    <div id="region-post">
+                        <div id="region-post" class="block-region">
         	        	    <div class="region-content">
             	        	    <?php echo $OUTPUT->blocks_for_region('side-post') ?>
 	                	    </div>
