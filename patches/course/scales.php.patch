diff --git a/course/scales.php b/course/scales.php
index 31a2e18..07bf4fa 100644
--- a/course/scales.php
+++ b/course/scales.php
@@ -1,55 +1,90 @@
-<?php // $Id$
-      // Allows a creator to edit custom scales, and also display help about scales
-
-    require_once("../config.php");
-    require_once("lib.php");
-
-    $id   = required_param('id', PARAM_INT);               // course id
-    $scaleid  = optional_param('scaleid', 0, PARAM_INT);   // scale id (show only this one)
-
-    if (! $course = get_record("course", "id", $id)) {
-        error("Course ID was incorrect");
-    }
-
+<?php
+
+// This file is part of Moodle - http://moodle.org/
+//
+// Moodle is free software: you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation, either version 3 of the License, or
+// (at your option) any later version.
+//
+// Moodle is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
+
+/**
+ * Allows a creator to edit custom scales, and also display help about scales
+ *
+ * @copyright 1999 Martin Dougiamas  http://dougiamas.com
+ * @deprecated - TODO remove this file or replace it with an alternative solution for scales overview
+ * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ * @package course
+ */
+
+require_once("../config.php");
+require_once("lib.php");
+
+$id   = required_param('id', PARAM_INT);               // course id
+$scaleid  = optional_param('scaleid', 0, PARAM_INT);   // scale id (show only this one)
+
+$url = new moodle_url('/course/scales.php', array('id'=>$id));
+if ($scaleid !== 0) {
+    $url->param('scaleid', $scaleid);
+}
+$PAGE->set_url($url);
+
+$context = null;
+if ($course = $DB->get_record('course', array('id'=>$id))) {
     require_login($course);
     $context = get_context_instance(CONTEXT_COURSE, $course->id);
-    require_capability('moodle/course:viewscales', $context);
-
-    $strscale = get_string("scale");
-    $strscales = get_string("scales");
-    $strcustomscale = get_string("scalescustom");
-    $strstandardscale = get_string("scalesstandard");
-    $strcustomscales = get_string("scalescustom");
-    $strstandardscales = get_string("scalesstandard");
-    $strname = get_string("name");
-    $strdescription = get_string("description");
-    $strhelptext = get_string("helptext");
-    $stractivities = get_string("activities");
-
-    print_header($strscales);
-
-    if ($scaleid) {
-        if ($scale = get_record("scale", 'id', $scaleid)) {
+} else {
+    //$id will be 0 for site level scales
+    require_login();
+    $context = get_context_instance(CONTEXT_SYSTEM);
+}
+
+$PAGE->set_context($context);
+require_capability('moodle/course:viewscales', $context);
+
+$strscales = get_string("scales");
+$strcustomscales = get_string("scalescustom");
+$strstandardscales = get_string("scalesstandard");
+
+$PAGE->set_title($strscales);
+if (!empty($course)) {
+    $PAGE->set_heading($course->fullname);
+} else {
+    $PAGE->set_heading($SITE->fullname);
+}
+echo $OUTPUT->header();
+
+if ($scaleid) {
+    if ($scale = $DB->get_record("scale", array('id'=>$scaleid))) {
             if ($scale->courseid == 0 || $scale->courseid == $course->id) {
 
                 $scalemenu = make_menu_from_list($scale->scale);
 
-                print_simple_box_start("center");
-                print_heading($scale->name);
+            echo $OUTPUT->box_start();
+            echo $OUTPUT->heading($scale->name);
                 echo "<center>";
-                choose_from_menu($scalemenu, "", "", "");
+            echo html_writer::select($scalemenu, 'unused');
                 echo "</center>";
                 echo text_to_html($scale->description);
-                print_simple_box_end();
-                close_window_button();
-                print_footer('empty');
+            echo $OUTPUT->box_end();
+            echo $OUTPUT->close_window_button();
+            echo $OUTPUT->footer();
                 exit;
             }
         }
-    }
+}
+
+$systemcontext = get_context_instance(CONTEXT_SYSTEM);
 
-    if ($scales = get_records("scale", "courseid", "$course->id", "name ASC")) {
-        print_heading($strcustomscales);
+if ($scales = $DB->get_records("scale", array("courseid"=>$course->id), "name ASC")) {
+    echo $OUTPUT->heading($strcustomscales);
 
         if (has_capability('moodle/course:managescales', $context)) {
             echo "<p align=\"center\">(";
@@ -58,43 +93,48 @@
         }
 
         foreach ($scales as $scale) {
+
+        $scale->description = file_rewrite_pluginfile_urls($scale->description, 'pluginfile.php', $systemcontext->id, 'grade', 'scale', $scale->id);
+
             $scalemenu = make_menu_from_list($scale->scale);
 
-            print_simple_box_start("center");
-            print_heading($scale->name);
+        echo $OUTPUT->box_start();
+        echo $OUTPUT->heading($scale->name);
             echo "<center>";
-            choose_from_menu($scalemenu, "", "", "");
+        echo html_writer::select($scalemenu, 'unused');
             echo "</center>";
             echo text_to_html($scale->description);
-            print_simple_box_end();
+        echo $OUTPUT->box_end();
             echo "<hr />";
         }
 
-    } else {
+} else {
         if (has_capability('moodle/course:managescales', $context)) {
             echo "<p align=\"center\">(";
             print_string("scalestip2");
             echo ")</p>";
         }
-    }
+}
 
-    if ($scales = get_records("scale", "courseid", "0", "name ASC")) {
-        print_heading($strstandardscales);
+if ($scales = $DB->get_records("scale", array("courseid"=>0), "name ASC")) {
+    echo $OUTPUT->heading($strstandardscales);
         foreach ($scales as $scale) {
+
+        $scale->description = file_rewrite_pluginfile_urls($scale->description, 'pluginfile.php', $systemcontext->id, 'grade', 'scale', $scale->id);
+
             $scalemenu = make_menu_from_list($scale->scale);
 
-            print_simple_box_start("center");
-            print_heading($scale->name);
+        echo $OUTPUT->box_start();
+        echo $OUTPUT->heading($scale->name);
             echo "<center>";
-            choose_from_menu($scalemenu, "", "", "");
+        echo html_writer::select($scalemenu, 'unused');
             echo "</center>";
             echo text_to_html($scale->description);
-            print_simple_box_end();
+        echo $OUTPUT->box_end();
             echo "<hr />";
         }
-    }
+}
 
-    close_window_button();
-    print_footer('empty');
+echo $OUTPUT->close_window_button();
+echo $OUTPUT->footer();
 
-?>
