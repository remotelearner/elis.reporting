diff --git a/course/editsection.php b/course/editsection.php
index cf411c2..e9a065b 100644
--- a/course/editsection.php
+++ b/course/editsection.php
@@ -1,72 +1,79 @@
-<?php // $Id$
-      // Edit the introduction of a section
-
-    require_once("../config.php");
-    require_once("lib.php");
-
-    $id = required_param('id',PARAM_INT);    // Week ID
-
-    if (! $section = get_record("course_sections", "id", $id)) {
-        error("Course section is incorrect");
-    }
-
-    if (! $course = get_record("course", "id", $section->course)) {
-        error("Could not find the course!");
-    }
-
-    require_login($course->id);
-
-    require_capability('moodle/course:update', get_context_instance(CONTEXT_COURSE, $course->id));
+<?php
+
+// This file is part of Moodle - http://moodle.org/
+//
+// Moodle is free software: you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation, either version 3 of the License, or
+// (at your option) any later version.
+//
+// Moodle is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
+
+/**
+ * Edit the introduction of a section
+ *
+ * @copyright 1999 Martin Dougiamas  http://dougiamas.com
+ * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
+ * @package course
+ */
+
+require_once("../config.php");
+require_once("lib.php");
+require_once($CFG->libdir.'/filelib.php');
+require_once('editsection_form.php');
+
+$id = required_param('id',PARAM_INT);    // Week/topic ID
+
+$PAGE->set_url('/course/editsection.php', array('id'=>$id));
+
+$section = $DB->get_record('course_sections', array('id' => $id), '*', MUST_EXIST);
+$course = $DB->get_record('course', array('id' => $section->course), '*', MUST_EXIST);
+
+require_login($course);
+$context = get_context_instance(CONTEXT_COURSE, $course->id);
+require_capability('moodle/course:update', $context);
+
+$editoroptions = array('context'=>$context ,'maxfiles' => EDITOR_UNLIMITED_FILES, 'maxbytes'=>$CFG->maxbytes, 'trusttext'=>false, 'noclean'=>true);
+$section = file_prepare_standard_editor($section, 'summary', $editoroptions, $context, 'course', 'section', $section->id);
+$section->usedefaultname = (is_null($section->name));
+$mform = new editsection_form(null, array('course'=>$course, 'editoroptions'=>$editoroptions));
+$mform->set_data($section); // set current value
 
 /// If data submitted, then process and store.
+if ($mform->is_cancelled()){
+    redirect($CFG->wwwroot.'/course/view.php?id='.$course->id);
 
-    if ($form = data_submitted() and confirm_sesskey()) {
-
-        $timenow = time();
-
-        if (! set_field("course_sections", "summary", $form->summary, "id", $section->id)) {
-            error("Could not update the summary!");
+} else if ($data = $mform->get_data()) {
+    if (empty($data->usedefaultname)) {
+        $section->name = $data->name;
+    } else {
+        $section->name = null;
         }
-
+    $data = file_postupdate_standard_editor($data, 'summary', $editoroptions, $context, 'course', 'section', $section->id);
+    $section->summary = $data->summary;
+    $section->summaryformat = $data->summaryformat;
+    $DB->update_record('course_sections', $section);
         add_to_log($course->id, "course", "editsection", "editsection.php?id=$section->id", "$section->section");
-
+    $PAGE->navigation->clear_cache();
         redirect("view.php?id=$course->id");
-        exit;
-    }
-
-/// Otherwise fill and print the form.
-
-    if (empty($form)) {
-        $form = $section;
-    } else {
-        $form = stripslashes_safe($form);
-    }
+}
 
-    // !! no db access using data from $form beyond this point !!
+$sectionname  = get_section_name($course, $section);
+$stredit      = get_string('edita', '', " $sectionname");
+$strsummaryof = get_string('summaryof', '', " $sectionname");
 
-    $usehtmleditor = can_use_html_editor();
+$PAGE->set_title($stredit);
+$PAGE->set_heading($course->fullname);
+$PAGE->navbar->add($stredit);
+echo $OUTPUT->header();
 
-/// Inelegant hack for bug 3408
-    if ($course->format == 'site') {
-        $sectionname  = get_string('site');
-        $stredit      = get_string('edit', '', " $sectionname");
-        $strsummaryof = get_string('summaryof', '', " $sectionname");
-    } else {
-        $sectionname  = get_section_name($course->format);
-        $stredit      = get_string('edit', '', " $sectionname $section->section");
-        $strsummaryof = get_string('summaryof', '', " $sectionname $section->section");
-    }
-
-    print_header_simple($stredit, '', build_navigation(array(array('name' => $stredit, 'link' => null, 'type' => 'misc'))), 'theform.summary' );
-
-    print_heading($strsummaryof);
-    print_simple_box_start('center');
-    include('editsection.html');
-    print_simple_box_end();
-
-    if ($usehtmleditor) {
-        use_html_editor("summary");
-    }
-    print_footer($course);
+echo $OUTPUT->heading($strsummaryof);
 
-?>
+$mform->display();
+echo $OUTPUT->footer();
